<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>My DApp Repo</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
</head>
<body>
  <h1>My DApp Repo</h1>
  <button onclick="connectWallet()">Connect Wallet</button>
  <p id="wallet">Not connected</p>

  <hr>
  <h2>FeedbackBoard</h2>
  <input id="fbMessage" placeholder="Your feedback"/>
  <button onclick="submitFeedback()">Submit Feedback</button>
  <button onclick="loadFeedback()">Load Feedback</button>
  <pre id="fbOutput"></pre>

  <hr>
  <h2>KudosToken</h2>
  <input id="kudosTo" placeholder="Recipient address"/>
  <input id="kudosAmount" placeholder="Amount"/>
  <button onclick="sendKudos()">Send Kudos</button>
  <button onclick="checkKudos()">Check Balance</button>
  <pre id="kudosOutput"></pre>

  <script>
    let provider, signer;
    let feedbackBoard, kudosToken;

    // === contract addresses ===
    const fbAddr = "PASTE_FEEDBACKBOARD_ADDRESS_HERE";
    const kudosAddr = "PASTE_KUDOSTOKEN_ADDRESS_HERE";

    // === contract ABIs ===
    const fbABI = [
      "function submitFeedback(string message)",
      "function getFeedback(uint256 index) view returns(address,string,uint256)",
      "function totalFeedback() view returns(uint256)"
    ];

    const kudosABI = [
      "function transfer(address to, uint256 value) returns(bool)",
      "function balanceOf(address owner) view returns(uint256)"
    ];

    async function connectWallet() {
      if (!window.ethereum) return alert("Install MetaMask!");
      provider = new ethers.providers.Web3Provider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      signer = provider.getSigner();
      document.getElementById("wallet").innerText = "Connected: " + await signer.getAddress();
      feedbackBoard = new ethers.Contract(fbAddr, fbABI, signer);
      kudosToken = new ethers.Contract(kudosAddr, kudosABI, signer);
    }

    // === FeedbackBoard ===
    async function submitFeedback() {
      const msg = document.getElementById("fbMessage").value;
      if (!msg) return alert("Enter feedback");
      const tx = await feedbackBoard.submitFeedback(msg);
      await tx.wait();
      alert("Feedback submitted!");
    }

    async function loadFeedback() {
      const total = await feedbackBoard.totalFeedback();
      let out = "";
      for (let i = 0; i < total; i++) {
        const [user, message, time] = await feedbackBoard.getFeedback(i);
        out += `${i}. ${user}: ${message} (${new Date(time*1000).toLocaleString()})\n`;
      }
      document.getElementById("fbOutput").innerText = out;
    }

    // === KudosToken ===
    async function sendKudos() {
      const to = document.getElementById("kudosTo").value;
      const amt = document.getElementById("kudosAmount").value;
      if (!to || !amt) return alert("Enter recipient and amount");
      const decimals = ethers.BigNumber.from("1000000000000000000"); // 1e18
      const value = ethers.BigNumber.from(amt).mul(decimals);
      const tx = await kudosToken.transfer(to, value);
      await tx.wait();
      alert("Kudos sent!");
    }

    async function checkKudos() {
      const addr = await signer.getAddress();
      const bal = await kudosToken.balanceOf(addr);
      const human = ethers.utils.formatUnits(bal, 18);
      document.getElementById("kudosOutput").innerText = "Balance: " + human + " KUDOS";
    }
  </script>
</body>
</html>
